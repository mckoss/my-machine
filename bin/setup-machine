#!/bin/bash
BIN_DIR="$(cd $(dirname ${BASH_SOURCE[0]}) && pwd)"
source $BIN_DIR/.envrc
source $BIN_DIR/setup-funcs.sh

mkdir -p $HOME/bin
mkdir -p $HOME/tmp
mkdir -p $GOPATH

if [[ $PLATFORM == "Mac" ]]; then
    if check_prog brew; then
        echo "Homebrew is already installed."
    else
        read -p "Install Homebrew package manager? (y/N): "
        if [ "$REPLY" == "y" ]; then
            ruby -e "$(curl -fsSL https://raw.github.com/Homebrew/homebrew/go/install)"
        fi
    fi

    if ! check_prog pip; then
        echo "Installing pip..."
        sudo easy_install pip
    fi
fi

read -p "Install Go 1.2? (y/N): "
if [ "$REPLY" == "y" ]; then
    GODOWNLOAD="https://go.googlecode.com/files/go1.2.linux-amd64.tar.gz"
    download "$GODOWNLOAD"
    sudo tar -C /usr/local -xzf $DOWN_DIR/$(basename "$GODOWNLOAD")
fi

read -p "Install Python dev? (y/N): "
if [ "$REPLY" == "y" ]; then
    get_pkgs build-essential
    get_pkgs python-software-properties
    get_pkgs python-dev
fi

if ! check_prog s3cmd; then
    echo "Installing s3cmd as root"
    sudo pip install s3cmd
fi

if [ $PLATFORM == "Linux" ]; then
    read -p "Install Node.js? (y/N): "
    if [ "$REPLY" == "y" ]; then
        sudo add-apt-repository ppa:chris-lea/node.js
        sudo apt-get update
        sudo apt-get install nodejs npm
        : sudo apt-get install nodejs-dev
    fi

    get_pkgs aptitude curl fping emacs23-nox openssh-server tree ack-grep screen
    get_pkgs python-pip python-virtualenv
    get_pkgs git mercurial
    get_pkgs make unzip

    if [ ! -f "$HOME/.s3cfg" ]; then
        s3cmd --configure
    fi
fi

ensure_py pep8
ensure_py pylint

if [ "$(git config --global user.name)" == "" ]; then
    read -p "Git Fullname: "
    git config --global user.name "$REPLY"
    read -p "Git Email: "
    git config --global user.email "$REPLY"
fi

link_files $HOME $PROJ_DIR/home/.*
link_files $HOME/.emacs.d $PROJ_DIR/home/*.el
link_files $HOME/.ssh $PROJ_DIR/ssh/*
